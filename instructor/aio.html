<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Job Efficiency: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="../favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="HPC Carpentry lesson about assessing job efficiency by HPC.NRW" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="HPC Carpentry lesson about assessing job efficiency by HPC.NRW" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Job Efficiency
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Job Efficiency
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Job Efficiency
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01_introduction.html">1. Introduction</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02_resourcerequirements.html">2. Resource Requirements</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03_schedulertools.html">3. Scheduler Tools</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04_scalingstudy.html">4. Scaling Study</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05_performancereports.html">5. Performance Overview</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06_pinning.html">6. Pinning</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07_bottlenecks.html">7. How to identify a bottleneck?</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08_accelerators.html">8. Performance of Accelerators</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09_nextsteps.html">9. Next Steps</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01_introduction"><p>Content from <a href="01_introduction.html">Introduction</a></p>
<hr>
<p>Last updated on 2025-09-24 |

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/episodes/01_introduction.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Why should I care about job performance?</li>
<li>How is efficiency defined?</li>
<li>How do I start measuring?</li>
<li>Is my job fast enough?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to …</p>
<ul>
<li>Use the <code>time</code> command for a first measurement.</li>
<li>Understand the benefits of efficient jobs.</li>
<li>Roughly estimate a job energy consumption based on core-h.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Intention: Step into the narrative </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Set up narrative:</p>
<ul>
<li>Important upcoming conference presentation</li>
<li>Time is ticking, the deadline is approaching way too fast</li>
<li>The talk is almost done, but, critically, we’re missing a picture
for the title slide</li>
<li>It should contain three snowmen, and we’ve exhausted our credits for
all generative AI models in previous chats with colleagues</li>
<li>=&gt; Ray tracing a scene to the rescue!</li>
<li>Issue: we need to try many different iterations of the scene to find
the exact right picture. How can we maximise the number of raytraced
snowman images before our conference deadline?</li>
<li>Ray tracing is expensive, but luckily we have access to an HPC
system</li>
</ul>
<p>What we’re doing here:</p>
<ul>
<li>Run workflow example for the first time</li>
<li>Simple <code>time</code> measurement to get started</li>
<li>Introduce different perspectives on efficiency</li>
<li>Core-h and correlation to cost in energy/money</li>
<li>Either set up the first Slurm job here or in the next episode</li>
</ul>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="setting-the-baseline">Setting the Baseline<a class="anchor" aria-label="anchor" href="#setting-the-baseline"></a>
</h2>
<hr class="half-width">
<p>Absolute performance is hard to determine:</p>
<ul>
<li>In comparison to current hardware (theoretical limits vs. real
usage)</li>
<li>Still important, if long way from theoretical limits</li>
<li>Always limited by something (one optimization just shifts to the
next saturated bottleneck)</li>
</ul>
<p>During optimization, performance is often expressed in relative terms
to a baseline measurement. Define “baseline”. Comparison between before
and after a change.</p>
<div id="exercise-baseline-measurement-with-time" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-baseline-measurement-with-time" class="callout-inner">
<h3 class="callout-title">Exercise: Baseline Measurement with
<code>time</code>
</h3>
<div class="callout-content">
<p>Simple measurement with <code>time</code> of example application.
Maybe also with <a href="https://github.com/sharkdp/hyperfine" class="external-link">hyperfine</a> ?</p>
<p>Observe system, user, and wall time.</p>
<p>Repeat measurements somewhere 3-10 times to reduce noise</p>
<ul>
<li>Average time</li>
<li>Minimum (observed best case)</li>
</ul>
<p>Maybe make a simple/obvious change to compare change to baseline. How
much relative improvement?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Example of how to run it and what the result looks like</p>
</div>
</div>
</div>
</div>
<p>Discuss meaning of system, user, wall-time. Relate to efficiencies
(minimal wall-time vs. minimal compute-time)</p>
</section><section><h2 class="section-heading" id="why-care-about-performance">Why Care About Performance?<a class="anchor" aria-label="anchor" href="#why-care-about-performance"></a>
</h2>
<hr class="half-width">
<p>Reasons from the perspective of learners (see profiles)</p>
<ul>
<li>Faster output, shorter iteration-/turn-around-time
<ul>
<li>More research per time</li>
<li>Opportunity costs when “accepting” worse performance</li>
<li>Trade of between time spent on optimizing vs. doing actual
research</li>
</ul>
</li>
<li>Potentially less wasted energy
<ul>
<li>Core-h / device-h directly correlate to wattage</li>
<li>Production of hardware and its operation costs energy (even when
idle)</li>
<li>=&gt; Buy as little hardware as possible and use it as much as you
can, if you have meaningful computations</li>
</ul>
</li>
<li>Applying for HPC resources in a larger center
<ul>
<li>Need estimate for expected resources</li>
<li>Jobs need to be sufficiently efficient</li>
<li>Is provided hardware a good fit for the applied computational
workload?</li>
</ul>
</li>
</ul>
<div id="exercise-why-care-about-performance" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-why-care-about-performance" class="callout-inner">
<h3 class="callout-title">Exercise: Why care about performance?</h3>
<div class="callout-content">
<p>maybe true-false statements as warmup exercise? E.g. something
like</p>
<ul>
<li>Better performance allows for more research</li>
<li>Application performance matters less on new computer hardware</li>
<li>Computations directory correlate to energy consumption</li>
<li>Good performance does not matter on my own hardware</li>
</ul>
<p><strong>All statements should be connected to the example job &amp;
narrative!</strong></p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<ul>
<li>True, shorter turn around times, more results per time, more nobel
prices per second!</li>
<li>False, new hardware might make performance issues less pressing, but
it is still important (opportunity costs, wasted energy, shared
resources)</li>
<li>True, device-hours consume energy (variable depending on utilized
features, amount of communication, etc.), but there is a direct
correlation to W</li>
<li>False, performance is especially important on shared systems, but
energy and opportunity costs also affect researchers on their own
hardware and exclusive allocations.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="core-h-and-energy">Core-h and Energy<a class="anchor" aria-label="anchor" href="#core-h-and-energy"></a>
</h2>
<hr class="half-width">
<p>Define core-h. Device usage for X seconds correlates to estimated
power draw. Real power usage depends on:</p>
<ul>
<li>Utilized features of the device (some more power-hungry than
others)</li>
<li>Amount of data movement through memory, data, network</li>
<li>Cooling (rule of thumb factor <span class="math inline">\(\times
2\)</span>)</li>
</ul>
<p>Looking at energy is one perspective on “efficiency”.</p>
<div id="exercise-core-h-and-energy-consumption" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-core-h-and-energy-consumption" class="callout-inner">
<h3 class="callout-title">Exercise: Core-h and Energy consumption</h3>
<div class="callout-content">
<ul>
<li>Figure out your current hardware (docu, cpuinfo, websearch,
LLM)</li>
<li>Calculate core-h for above test (either including or excluding
repetitions)</li>
<li>Estimate power usage with TDP</li>
<li>Keep it simple, back of the envelope calculations</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Example for an existing cluster. Stick to CPU TDP, maybe rough number
for whole node from somewhere, multiply factor 2 for cooling, mention
not-covered network and storage infrastructure</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="what-is-efficient">What is Efficient?<a class="anchor" aria-label="anchor" href="#what-is-efficient"></a>
</h2>
<hr class="half-width">
<div id="challenge-many-perspectives-on-efficiency" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-many-perspectives-on-efficiency" class="callout-inner">
<h3 class="callout-title">Challenge: Many perspectives on
Efficiency</h3>
<div class="callout-content">
<p>Write down your current definition or understanding of efficiency
with respect to HPC jobs. (Shared document?)</p>
<p>(Exercise as think, pair, share?)</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>E.g. shortest time from submission to job completion.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>Many definitions of efficiency (see below)</p>
</div>
</div>
</div>
</div>
<div id="discussion-which-definition-should-we-take" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="discussion-which-definition-should-we-take" class="callout-inner">
<h3 class="callout-title">Discussion: Which definition should we
take?</h3>
<div class="callout-content">
<p>Are these perspectives equally useful? Is one particularly suited to
our discussion?</p>
</div>
</div>
</div>
<p>Many definitions of efficiency (to be ordered and discussed):</p>
<ol style="list-style-type: decimal">
<li>Minimal wall-/human-time of the job</li>
<li>Minimal compute-time</li>
<li>Minimal time-to-solution (like 1, including queue wait times,
potentially multiple jobs for combined results)</li>
<li>Minimal cost in terms of energy/someones money</li>
<li>With regards to opportunity costs. Amount of research per job
(including waiting times, computation time, slowdown through larger
iteration cycles (turn around times))</li>
</ol>
<p>Assuming only “useful” computations, no redundancies.</p>
<p>Which definition do refer to by default in the following episodes?
(Do we need a default?)</p>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<div id="exercise-recollecting-efficiency" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="exercise-recollecting-efficiency" class="callout-inner">
<h3 class="callout-title">Exercise: Recollecting efficiency</h3>
<div class="callout-content">
<p>Exercise to raise the question if example workload is efficient or
not. Do we know yet? -&gt; No, we can only tell how long it takes,
estimate how much time/resources it consumes, and if there is a relative
improvement on a change</p>
</div>
</div>
</div>
<p>Leading question: Single baseline measurement doesn’t say much about
the application performance, how can I get an understanding of
performance? -&gt; Vary a parameter in the next episode and touch on
Slurm options</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Absolute vs. relative performance measurements
<ul>
<li>
<code>time</code> to establish a baseline</li>
<li>Estimating energy consumption</li>
</ul>
</li>
<li>Job performance affects you as a user</li>
<li>Core-h and very rough energy estimate</li>
<li>Different perspectives on efficiency
<ul>
<li>Definitions: wall/human-time, compute-time, time-to-solution, energy
(costs / environment), Money, opportunity cost (less research
output)</li>
</ul>
</li>
<li>Relationship between performance and computer hardware</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-02_resourcerequirements"><p>Content from <a href="02_resourcerequirements.html">Resource Requirements</a></p>
<hr>
<p>Last updated on 2025-11-05 |

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/episodes/02_resourcerequirements.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How many resources should I request initially?</li>
<li>What scheduler options exist to request resources?</li>
<li>How do I know if they are used well?</li>
<li>How large is my HPC cluster?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to …</p>
<ul>
<li>Identify the size of their jobs in relation to the HPC system.</li>
<li>Request a good amount of resources from the scheduler.</li>
<li>Change the parameters to see how the execution time changes.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Objective: Vary one parameter and compare to baseline
  </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Narrative:</p>
<ul>
<li>We didn’t use the HPC system in a while</li>
<li>Not sure how many resources we need and what our HPC system even
offer</li>
<li>How could I look it up again?</li>
<li>What were the parameters of scheduled jobs again?</li>
<li>What’s a good first guess for the resources I need for an individual
render?</li>
</ul>
<p>What we’re doing here:</p>
<ul>
<li>Learn about Slurm job parameters</li>
<li>Develop intuition about job size with respect to the cluster</li>
<li>First impression of whats a “good” amount of resources to request
for a job</li>
</ul>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="starting-somewhere">Starting Somewhere<a class="anchor" aria-label="anchor" href="#starting-somewhere"></a>
</h2>
<hr class="half-width">
<p>Didactic path: I have no idea how many resources to ask for -&gt;
just guess and start with some combinations. Next identify slower, or
failed (OOM, timelimit) and choose the best What does that say about
efficiency?</p>
<div id="what-is-a-scheduler-and-why-do-we-need-one" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="what-is-a-scheduler-and-why-do-we-need-one" class="callout-inner">
<h3 class="callout-title">What is a scheduler and why do we need
one?</h3>
<div class="callout-content">
<p>HPC machines offer a large amount of compute power but are too
expensive for a single person or a small research group. Therefore, HPC
machines are deployed as shared resources with substantional user
communities ranging from dozens to thousands of users. In such a
scenario you need a way to manage who gets to run which calculation on
what part of the machine at what time. A scheduler is a software package
to let users request resources for a job. It creates the schedule of
what job gets to run on what resources and when.</p>
<p>Historically, there have been many schedulers, for example, <a href="https://www.ibm.com/products/load-balancer" class="external-link"><code>Loadbalancer</code></a>,
<a href="https://docs.oracle.com/cd/E19279-01/820-3257-12/n1ge.html" class="external-link"><code>GridEngine</code></a>,
<a href="https://www.openpbs.org/" class="external-link"><code>PBS</code></a>, <a href="https://docs.adaptivecomputing.com/maui/" class="external-link"><code>Maui</code></a>,
and others. In the early 2000s the development of “<a href="https://doi.org/10.1007/10968987_3" class="external-link">SLURM</a>: Simple Linux
Utility for Resource Management” began. With the rise of Linux on HPC
systems SLURM has become a widely used scheduling system. For that
reason this course assumes that SLURM is available on your HPC
system.</p>
</div>
</div>
</div>
<div id="exercise-starting-somewhere" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="exercise-starting-somewhere" class="callout-inner">
<h3 class="callout-title">Exercise: Starting Somewhere</h3>
<div class="callout-content">
<ul>
<li>Run job with a timelimit of 1 minute -&gt; Trigger timelimit. What’s
a good timelimit for our task?</li>
<li>Run job with few cores, but too much memory/core -&gt; Trigger OOM.
What’s a good memory limit for our task?</li>
<li>Run job with requesting way too many cores -&gt; Endless waiting or
not accepted due to account limits. What’s a good CPU limit for our
task?</li>
<li>
<code>squeue</code> to learn about scheduling issues / reasons</li>
</ul>
</div>
</div>
</div>
<p>Summarize dimensions in which a job has to be sized correctly (time,
cores, memory, gpus, …).</p>
</section><section><h2 class="section-heading" id="compared-to-the-hpc-system">Compared to the HPC System<a class="anchor" aria-label="anchor" href="#compared-to-the-hpc-system"></a>
</h2>
<hr class="half-width">
<ul>
<li>What’s the relationship between your job and existing hardware of
the system?
<ul>
<li>What hardware does your HPC system offer?</li>
<li>Documentation and Slurm commands</li>
</ul>
</li>
<li>Is my job large or small?
<ul>
<li>What’s considered large, medium, small? Maybe as percentage of whole
system?</li>
<li>Issues of large jobs: long waiting times</li>
<li>Issues of many (thousands) small jobs:</li>
</ul>
</li>
<li>How many resources are currently free?</li>
<li>How long do I have to wait? (looking up scheduler estimate + apply
common sense)</li>
</ul>
<div id="exercise-comparing-to-the-system" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="exercise-comparing-to-the-system" class="callout-inner">
<h3 class="callout-title">Exercise: Comparing to the system</h3>
<div class="callout-content">
<ul>
<li>
<code>sinfo</code> to learn about partitions and free resources</li>
<li>
<code>scontrol</code> to learn about nodes in those partitions</li>
<li>
<code>lscpu</code> and <code>cat /proc/cpuinfo</code>
</li>
<li>Submit a job with a reasonable number of resources and use
<code>squeue</code> and/or <code>scontrol show job</code> to learn about
Slurms estimated start time</li>
</ul>
<p>Answer questions about number and type of CPUs, HT/SMT, memory/core,
timelimits.</p>
<p>Summarize with a well sized job that’s a good start for the
example.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="requesting-resources">Requesting Resources<a class="anchor" aria-label="anchor" href="#requesting-resources"></a>
</h2>
<hr class="half-width">
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  ToDo
  </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>This section is just an info dump, how do we make it useful and
approachable? What’s a useful exercise? Maybe put info here in other
sections?</p>
</div>
</div>
</div>
</div>
<p>More detail about what <a href="https://slurm.schedmd.com/sbatch.html" class="external-link">Slurm provides</a> (among
others):</p>
<ul>
<li>
<code>-t, --time=&lt;time&gt;</code>: Time limit of the job</li>
<li>
<code>-N, --nodes</code>: Number of nodes</li>
<li>
<code>-n, --ntasks</code>: Number of tasks/processes</li>
<li>
<code>-c, --cpus-per-task</code>: Number of CPUs per
task/process</li>
<li>
<code>--threads-per-core=&lt;threads&gt;</code>: Select nodes with
at least the number threads per CPU</li>
<li>
<code>--mem=&lt;size&gt;[units]</code>: Memory, but can also be as
<code>--mem-per-cpu</code>, …</li>
<li>
<code>-G, --gpus</code>: Number of GPUs</li>
<li><code>--exclusive</code></li>
</ul>
<p>Maybe discuss:</p>
<ul>
<li>Minimizing/maximizing involved number of nodes
<ul>
<li>Shared nodes: longer waiting times until a whole node is empty</li>
<li>Min/max number of nodes min/maximizes communication</li>
</ul>
</li>
<li>Different wait times for certain configurations
<ul>
<li>Few tasks on many shared nodes might schedule faster than many tasks
on few exclusive nodes.</li>
</ul>
</li>
<li>What is a task / process – Difference?</li>
<li>Requesting memory, more than mem/core -&gt; idle cores</li>
</ul></section><section><h2 class="section-heading" id="changing-requirements">Changing requirements<a class="anchor" aria-label="anchor" href="#changing-requirements"></a>
</h2>
<hr class="half-width">
<ul>
<li>Motivate why requirements might change (resolution in simulation,
more data, more complex model, …)</li>
<li>How to change requested resources if application should run
differently? (e.g. more processes)</li>
<li>Considerations &amp; estimates for
<ul>
<li>changing compute-time (more/less workload)</li>
<li>changing memory requirements (smaller/larger model)</li>
<li>changing number of processes / nodes</li>
<li>changing I/O -&gt; more/less or larger/smaller files</li>
</ul>
</li>
</ul>
<div id="exercise-changing-requirements" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="exercise-changing-requirements" class="callout-inner">
<h3 class="callout-title">Exercise: Changing requirements</h3>
<div class="callout-content">
<ul>
<li>Walk through how to estimate increase in CPU cores / memory,
etc.</li>
<li>Run previous job with larger workload</li>
<li>Check if and how it behaves differently than the smaller job</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<div id="discussion-recollection" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="discussion-recollection" class="callout-inner">
<h3 class="callout-title">Discussion: Recollection</h3>
<div class="callout-content">
<p>Circle back to efficiency. What’s considered good/efficient in
context of job requirements and parameters?</p>
</div>
</div>
</div>
<p>Leading question: <code>time</code> doesn’t give much information, is
there an easy way to get more? -&gt; See what Slurm tools can tell about
our previous jobs</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Estimate resource requirements and request them in terms the
scheduler understands</li>
<li>Be aware of your job in relation to the whole system (available
hardware, size)</li>
<li>Aim for a good match between requested and utilized resources</li>
<li>Optimal time-to-solution by minimizing batch queue times and
maximizing parallelism</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-03_schedulertools"><p>Content from <a href="03_schedulertools.html">Scheduler Tools</a></p>
<hr>
<p>Last updated on 2025-11-11 |

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/episodes/03_schedulertools.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What can the scheduler tell about job performance?</li>
<li>What’s the meaning of collected metrics?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to …</p>
<ul>
<li>Explain basic performance metrics.</li>
<li>Use tools provided by the scheduler to collect basic performance
metrics of their jobs.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Intention: Introduce more basic performance metrics </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Narrative:</p>
<ul>
<li>Okay, so first couple of jobs ran, but were they “quick
enough”?</li>
<li>How many renders could I generate per minute/hour/day according to
the current utilization</li>
<li>Our cluster uses certain hardware, maybe we didn’t use it as much as
we could have?</li>
<li>But I couldn’t see all metrics (may be cluster dependent) (Energy,
Disk I/O, Network I/O?)</li>
</ul>
<p>What we’re doing here:</p>
<ul>
<li>What <code>seff</code> and <code>sacct</code> have to offer</li>
<li>Introduce simple relation to hardware, what does RSS, CPU, Disk
read/write and their utilization mean?</li>
<li>Point out what’s missing from a complete picture</li>
</ul>
<p>Note:</p>
<ul>
<li>
<code>seff</code> is an optional SLURM tool. It does not come
standard with every SLURM installation. Therefore, make sure beforehand
that this tool is available for the students.</li>
</ul>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="scheduler-tools">Scheduler Tools<a class="anchor" aria-label="anchor" href="#scheduler-tools"></a>
</h2>
<hr class="half-width">
<p>A scheduler performs important tasks such as accepting and scheduling
jobs, monitoring job status, starting user applications, cleaning up
jobs that have finished or exceeded their allocated time. The scheduler
also keeps a history of jobs that have been run and how they behaved.
The information that is collected can be queried by the job owner to
learn about how the job utilized the resources it was given.</p>
<div class="section level3">
<h3 id="the-seff-tool">The <code>seff</code> tool<a class="anchor" aria-label="anchor" href="#the-seff-tool"></a>
</h3>
<p>The <code>seff</code> command can be used to learn about how
efficiently your job has run. The <code>seff</code> command takes the
job identifier as an argument to select which job it displays
information about. That means we need to run a job first to get a job
identifier we can query SLURM about. Then we can ask about the
efficiency of the job.</p>
<div id="seff-may-not-be-available" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="seff-may-not-be-available" class="callout-inner">
<h3 class="callout-title">
<code>seff</code> may not be available</h3>
<div class="callout-content">
<p><code>seff</code> is an optional SLURM tool for more convenient
access to <code>saact</code>. It does not come standard with every SLURM
installation. Your particular HPC system may or may not provide it.
Check for it’s availability on your login nodes, or consult your cluster
documentation or support staff.</p>
<p>Other third party alternatives, e.g. <a href="https://github.com/troycomi/reportseff/" class="external-link">reportseff</a>, can be
installed with default user permissions.</p>
</div>
</div>
</div>
<p>The <code>sbatch</code> command is used to submit a job. It takes a
job script as an argument. The job script contains the resource
requests, such as the amount of time needed for the calculation, the
number of nodes, the number of tasks per node, and so on. It also
contains the commands to execute the calculations.</p>
<p>Using your favorite editor, create the job script
<code>render_snowman.sbatch</code> with the contents below.</p>
<pre class="input"><code>#!/usr/bin/bash
#SBATCH --time=01:00:00
#SBATCH --nodes=1
#SBATCH --tasks-per-node=4

# Possibly a "module load ..." command to load required libraries
# Depends on your particular HPC system

mpirun -np 4 raytracer -width=800 -height=800 -spp=128 -alloc_mode=3</code></pre>
<p>Next submit the job with <code>sbatch</code>, and see what
<code>seff</code> says about the job with the following commands.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="va">jobid</span><span class="op">=</span><span class="va">$(</span><span class="ex">sbatch</span> <span class="at">--parsable</span> render_snowman.sbatch<span class="va">)</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">seff</span> <span class="va">$jobid</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Job ID: 309489
Cluster: bigiron
User/Group: usr123/grp123
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 4
CPU Utilized: 00:07:43
CPU Efficiency: 98.93% of 00:07:48 core-walltime
Job Wall-clock time: 00:01:57
Memory Utilized: 35.75 MB
Memory Efficiency: 0.20% of 17.58 GB (4.39 GB/core)</code></pre>
</div>
<p>The job script we created asks for 4 CPUs for an hour. After
submitting the job script we need to wait until the job has finished as
<code>seff</code> can only report sensible statistics after the job is
completed. The report from <code>seff</code> shows basic statistics
about the job, such as</p>
<ul>
<li>The resources the job was given
<ul>
<li>the number of nodes</li>
<li>the number of cores per node</li>
<li>the amount of memory per core</li>
</ul>
</li>
<li>The amount of resources used
<ul>
<li>
<code>CPU Utilized</code> the aggregate CPU time (the time the job
took times the number of CPUs allocated)</li>
<li>
<code>CPU Efficiency</code> the actual CPU usage as a percentage of
the total available CPU capacity</li>
<li>
<code>Job Wall-clock time</code> the time the job took from start to
finish</li>
<li>
<code>Memory Utilized</code> the aggregate memory usage</li>
<li>
<code>Memory Efficiency</code> the actual memory usage as a
percentage of the total avaialable memory</li>
</ul>
</li>
</ul>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Todo: give clear recommendation of what to aim for? </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>Maybe 80% of job time?</p>
</div>
</div>
</div>
</div>
<p>Looking at the <code>Job Wall-clock time</code> it shows that the job
took just under 2 minutes. Therefore this job took a lot less time than
the one hour we asked for. This can be problematic as the scheduler
looks for time windows when it can fit a job in. Long running jobs
cannot be squeezed in as easily as short running jobs. As a result, jobs
that request a long time to complete typically have to wait longer
before they can be started. Therefore asking for more than 10 times as
much time as the job really needs, simply means that you will have to
wait longer for the job to start. On the other hand you do not want to
ask for too little time. Few things are more annoying than waiting for a
long running calculation to finish, just to see the job being killed
right before the end because it would have needed a couple of minutes
more than you asked for. So the best approach is to ask for more time
than the job needs, but not go overboard here. As the job elapse time
depends on many machine conditions, including congestion in the data
communication, disk access, operating system jitter, and so on, you
might want to ask for a substantial buffer. Nevertheless, asking for
more than twice as much time as job is expected to need, usually doesn’t
make sense.</p>
<p>Another thing is that SLURM by default reserves a certain amount of
memory per core. In this case the actual memory usage is just a fraction
of that amount. We could reduce the memory allocation by explicitly
asking for less by modifying the <code>render_snowman.sbatch</code> job
script.</p>
<div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Todo: potential issue? </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor3" aria-labelledby="headingInstructor3">
<div class="accordion-body">
<p>Running this on our cluster and adding a module load command resulted
in 600MB of memory required. My guess is, this is due to cgroups_v2 and
Page caches being counted towards the job as well, so loading the
modules might spike the resource requirements as well?</p>
<p>Maybe we should play it safe and use a larger value in the following
exercise. But we also want to teach not overdoing it, so it’d be good if
we can find a useful but generic compromise here</p>
</div>
</div>
</div>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Edit the batch file to reduce the amount of memory requested for the
job. Note that the amount of memory per node can be requested with the
<code>--mem=</code> argument. The amount of memory is specified by a
number followed by a unit. The units can represent kilobtytes (KB),
megabytes (MB), gigabytes (GB). For the calculations we are doing here
100 megabytes per node is more than sufficient. Submit the job, and
inspect the efficiency with <code>seff</code>. What is the memory usage
efficiency you get?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The batch file after adding the memory request becomes.</p>
<pre class="input"><code>#!/usr/bin/bash
#SBATCH --time=01:00:00
#SBATCH --nodes=1
#SBATCH --tasks-per-node=4
#SBATCH --mem=100MB

# Possibly a "module load ..." command to load required libraries
# Depends on your particular HPC system

mpirun -np 4 raytracer -width=800 -height=800 -spp=128 -alloc_mode=3</code></pre>
<p>Submit this jobscript, as before, with the following command.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="va">jobid</span><span class="op">=</span><span class="va">$(</span><span class="ex">sbatch</span> <span class="at">--parsable</span> render_snowman.sbatch<span class="va">)</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">seff</span> <span class="va">$jobid</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Job ID: 310002
Cluster: bigiron
User/Group: usr123/grp123
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 4
CPU Utilized: 00:07:43
CPU Efficiency: 98.09% of 00:07:52 core-walltime
Job Wall-clock time: 00:01:58
Memory Utilized: 50.35 MB
Memory Efficiency: 50.35% of 100.00 MB (100.00 MB/node)</code></pre>
</div>
<p>The output of <code>seff</code> shows that about 50% of requested
memory was used.</p>
</div>
</div>
</div>
</div>
<p>Now we see that a much larger fraction of the allocated memory has
been used. Normally you would not worry too much about the memory
request. Lately HPC clusters are used more for machine learning work
loads which tend to require a lot of memory. Their memory requirements
per core might actually be so large that they cannot use all the cores
in a node. So there may be spare cores available for jobs that need
little memory. In such a scenario tightening the memory allocation up
could allow the scheduler to start your job early. How much milage you
might get from this depends on the job mix at the HPC site where you run
your calculations.</p>
<p>Note that the CPU utilization is reported as almost 100%, but this
just means that the CPU was busy with your job 100% of the time. It does
not mean that this time was well spent. For example, every parallel
program has some serial parts to the code. Typically those parts are
executed redundantly on all cores, which is wasteful but not reflected
in the CPU efficiency. Also, this number does not reflect how well the
capabilities of the CPU are used. If your CPU offers vector
instructions, for example, but your code does not use them then your
code will just run slow. The CPU efficiency will still show that the CPU
was busy 100% of the time even though the program is just running at a
fraction of the speed it could achieve if it fully exploited the
hardware capabilities. It is worth keeping these limitations of
<code>seff</code> in mind.</p>
<div id="good-utilization-does-not-imply-efficiency" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="good-utilization-does-not-imply-efficiency" class="callout-inner">
<h3 class="callout-title">Good utilization does not imply
efficiency</h3>
<div class="callout-content">
<p>Measuring close to 100% CPU utilization does not say anything about
how useful the calculations are. It’s merely stating, that the CPU was
mostly busy with calculations, instead of waiting for data or running
idle, waiting for other conditions to occur.</p>
<p>Good CPU utilization is only efficient, if it runs only “useful”
calculations that contribute with new results towards an intended
goal.</p>
</div>
</div>
</div>
<p>The <code>seff</code> command cannot give you any information about
the I/O performance of your job. You have to use other approaches for
that, and <code>sacct</code> may be one of them.</p>
</div>
<div class="section level3">
<h3 id="the-sacct-tool">The <code>sacct</code> tool<a class="anchor" aria-label="anchor" href="#the-sacct-tool"></a>
</h3>
<div id="accordionInstructor4" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor4" aria-expanded="false" aria-controls="collapseInstructor4">
  <h3 class="accordion-header" id="headingInstructor4">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor4" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor4" aria-labelledby="headingInstructor4">
<div class="accordion-body">
<p>Note that the information <code>sacct</code> can provide depends on
the information that SLURM stores on a given machine. By default this
includes Billing, CPU, Energy, Memory, Node, FS/Disk, Pages and VMem.
Additional information is available only when SLURM is configured to
collect it. These additional trackable resources are listed in
<code>AccountingStorageTRES</code>. For I/O <code>fs/lustre</code> is
commonly useful, and for the interconnect communication
<code>ic/ofed</code> is required. The setting
<code>AccountingStorageTRES</code> is found in <code>slurm.conf</code>.
Unfortunately there doesn’t seem to be a way to get <code>sacct</code>
to print the optional trackable resources.</p>
</div>
</div>
</div>
</div>
<p>The <code>sacct</code> command shows data stored in the job
accounting database. You can query the data of any of your previously
run jobs. Just like with <code>seff</code> you will need to provide the
job ID to query the accounting database. Rather than keeping track of
all your jobs yourself you can ask <code>sacct</code> to provide you
with an overview of the jobs you have run.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">sacct</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JobID           JobName  Partition    Account  AllocCPUS      State ExitCode
------------ ---------- ---------- ---------- ---------- ---------- --------
309902       render_sn+  STD-s-96h  project_a          4  COMPLETED      0:0
309902.batch      batch             project_a          4  COMPLETED      0:0
309902.exte+     extern             project_a          4  COMPLETED      0:0
309903       render_sn+  STD-s-96h  project_a          4  COMPLETED      0:0
309903.batch      batch             project_a          4  COMPLETED      0:0
309903.exte+     extern             project_a          4  COMPLETED      0:0
310002       render_sn+  STD-s-96h  project_a          4  COMPLETED      0:0
310002.batch      batch             project_a          4  COMPLETED      0:0
310002.exte+     extern             project_a          4  COMPLETED      0:0</code></pre>
</div>
<p>In the output every job is shown three times here. This is because
<code>sacct</code> lists one line for the primary job entry, followed by
a line for every job step. A job step corresponds to an
<code>mpirun</code> or <code>srun</code> command. The
<code>extern</code> line corresponds to all work that is done outside of
SLURM’s control, for example an <code>ssh</code> command that runs
something somewhere else.</p>
<p>Note that by default <code>sacct</code> only lists the jobs that have
been run today. You can use the <code>--starttime</code> option to list
all jobs that have been run since the given start date. For example, try
running</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">sacct</span> <span class="at">--starttime</span><span class="op">=</span>2025-09-25</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JobID           JobName  Partition    Account  AllocCPUS      State ExitCode
------------ ---------- ---------- ---------- ---------- ---------- --------
308755       snowman.s+  STD-s-96h  project_a         16  COMPLETED      0:0
308755.batch      batch             project_a         16  COMPLETED      0:0
308755.exte+     extern             project_a         16  COMPLETED      0:0
308756       snowman.s+  STD-s-96h  project_a          4  COMPLETED      0:0
308756.batch      batch             project_a          4  COMPLETED      0:0
308756.exte+     extern             project_a          4  COMPLETED      0:0
309486       interacti+  STD-s-96h  project_a          4     FAILED      1:0
309486.exte+     extern             project_a          4  COMPLETED      0:0
309486.0          prted             project_a          4  COMPLETED      0:0
309489       render_sn+  STD-s-96h  project_a          4  COMPLETED      0:0
309489.batch      batch             project_a          4  COMPLETED      0:0
309489.exte+     extern             project_a          4  COMPLETED      0:0
309902       render_sn+  STD-s-96h  project_a          4  COMPLETED      0:0
309902.batch      batch             project_a          4  COMPLETED      0:0
309902.exte+     extern             project_a          4  COMPLETED      0:0
309903       render_sn+  STD-s-96h  project_a          4  COMPLETED      0:0
309903.batch      batch             project_a          4  COMPLETED      0:0
309903.exte+     extern             project_a          4  COMPLETED      0:0
310002       render_sn+  STD-s-96h  project_a          4  COMPLETED      0:0
310002.batch      batch             project_a          4  COMPLETED      0:0
310002.exte+     extern             project_a          4  COMPLETED      0:0</code></pre>
</div>
<p>You may want to change the date of <code>2025-09-25</code> to
something more sensible when you work through this tutorial. Note that
some HPC systems may limit the range of such a request to a maximum of,
for example, 30 days to avoid overloading the slurm database with too
large requests.</p>
<p>With the job ID you can ask <code>sacct</code> for information about
a specific job as in</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">sacct</span> <span class="at">--jobs</span><span class="op">=</span>310002</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JobID           JobName  Partition    Account  AllocCPUS      State ExitCode
------------ ---------- ---------- ---------- ---------- ---------- --------
310002       render_sn+  STD-s-96h  project_a          4  COMPLETED      0:0
310002.batch      batch             project_a          4  COMPLETED      0:0
310002.exte+     extern             project_a          4  COMPLETED      0:0</code></pre>
</div>
<p>Using <code>sacct</code> with the <code>--jobs</code> flag is just
another way to select which jobs we want more information about. In
itself it does not provide any additional information. To get more
specific data we need to explicitly ask for the information we want. As
SLURM collects a broad range of data about every job it is worth to
evaluate what the most relevant items are.</p>
<div id="accordionInstructor5" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor5" aria-expanded="false" aria-controls="collapseInstructor5">
  <h3 class="accordion-header" id="headingInstructor5">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Todo: extend the following list and examples to include CPU </h3>
</button>
<div id="collapseInstructor5" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor5" aria-labelledby="headingInstructor5">
<div class="accordion-body">
<p>To reconstruct the CPU utilization reported by <code>seff</code>: -
<code>TotalCPU</code>/<code>CPUTime</code> should give the percentage -
Could also mention <code>UserCPU</code> and <code>SystemCPU</code> and
discuss the difference? Both result in <code>TotalCPU</code></p>
<p>Maybe remove <code>AveCPUFreq</code> instead, or do we try to teach
something specific about it?</p>
<p>Don’t forget to change the example output of all <code>sacct</code>s
in the following examples/challenges!</p>
</div>
</div>
</div>
</div>
<ul>
<li>
<code>MaxRSS</code>, <code>AveRSS</code>, or the Maximum or Average
Resident Size Set (RSS). The RSS is the memory allocated by a program
that is actually resident in the main memory of the computer. If the
computer gets low on memory then the virtual memory manager can extend
the apparently available memory by moving some of the data from memory
to disk. This is done entirely transparently to the application, but the
data that has been moved to disk is no longer resident in main memory.
As a result accessing it will be slower because it needs to retrieved
from disk first. Therefore if the RSS is small compared to the total
amount of memory the program uses this might affect the performance of
the program.</li>
<li>
<code>MaxPages</code>, <code>AvePages</code>, or the Maximum or
Average number of Page Faults. These quantities are related to the
Resident Size Sets. When the program tries to access data that is not
resident in main memory this triggers a page fault. The virtual memory
manager responds to a page fault by retrieving the accessed data from
disk (and potentially migrating other data to disk to make space). These
operations are typically costly. Therefore high numbers of page faults
typically correspond to a significant reduction in the program’s
performance. For example, the CPU utilization might drop from as high as
98% to as low as 2% due to page faults. For that reason some HPC
machines are configured to kill your job if the application generates a
high rate of page faults.</li>
<li>
<code>AllocCPUS</code> is the number of CPUs allocated for the
job.</li>
<li>
<code>Elapsed</code> is the amount of wall clock time it took to
complete the job. I.e. the amount of time that passed between the start
and finish of the job.</li>
<li>
<code>MaxDiskRead</code>, the Maximum amount of data read from
disk.</li>
<li>
<code>MaxDiskWrite</code>, the Maximum amount of data written to
disk.</li>
<li>
<code>ConsumedEnergy</code>, the amount of energy consumed by the
job if that information was collected. The data may not be collected on
your particular HPC system and is reported as 0.</li>
<li>
<code>AveCPUFreq</code>, the average CPU frequency of all tasks in a
job, given in kHz. In general the higher the clock frequency of the
processor the faster the calculation runs. The exception is if the
application is memory bandwidth limited and the data cannot be moved to
processor fast enough to keep it busy. In that case modern hardware
might throttle the frequency. This saves energy as the power consumption
scales linearly with the clock frequency, but doesn’t slow the
calculation down as the processor was having to wait for data
anyway.</li>
</ul>
<p>We can explicitly select the data elements that we are interested in.
To see how long the job took to complete run</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">sacct</span> <span class="at">--jobs</span><span class="op">=</span>310002 <span class="at">--format</span><span class="op">=</span>Elapsed</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>   <span class="va">Elapsed</span></span>
<span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span></span>
<span>  <span class="fl">00</span><span class="op">:</span><span class="fl">01</span><span class="op">:</span><span class="fl">58</span></span>
<span>  <span class="fl">00</span><span class="op">:</span><span class="fl">01</span><span class="op">:</span><span class="fl">58</span></span>
<span>  <span class="fl">00</span><span class="op">:</span><span class="fl">01</span><span class="op">:</span><span class="fl">58</span></span></code></pre>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Request information regarding all of the above variables from
<code>sacct</code>, including <code>JobID</code>. Note that the
<code>--format</code> flag takes a comma separated list. Also note that
the result shows that more data is read than written, even though the
program generates and write an image, and reads no data at all. Why
would that be?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>To query all of the above variable run</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">sacct</span> <span class="at">--jobs</span><span class="op">=</span>310002 <span class="at">--format</span><span class="op">=</span>MaxRSS,AveRSS,MaxPages,AvePages,AllocCPUS,Elapsed,MaxDiskRead,MaxDiskWrite,ConsumedEnergy,AveCPUFreq</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    MaxRSS     AveRSS MaxPages   AvePages  AllocCPUS    Elapsed  MaxDiskRead MaxDiskWrite ConsumedEnergy AveCPUFreq
---------- ---------- -------- ---------- ---------- ---------- ------------ ------------ -------------- ----------
                                                   4   00:01:58                                        0
    51556K     51556K      132        132          4   00:01:58        6.91M        0.72M              0         3M
         0          0        0          0          4   00:01:58        0.01M        0.00M              0         3M</code></pre>
</div>
<p>Although the program we have run generates an image and writes that
to a file, there is also a none zero amount of data read. The writing
part is associated with the image file the program writes. The reading
part is not associated with anything that the program does, as it
doesn’t read anything from disk. It is instead associated with the fact
that the operating system has to read the program itself and it’s
dependencies to execute it.</p>
</div>
</div>
</div>
</div>
<div id="accordionInstructor6" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor6" aria-expanded="false" aria-controls="collapseInstructor6">
  <h3 class="accordion-header" id="headingInstructor6">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Give more insight in the collected sacct metrics </h3>
</button>
<div id="collapseInstructor6" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor6" aria-labelledby="headingInstructor6">
<div class="accordion-body">
<ul>
<li>
<code>AllocCPUS</code>: number of CPU cores we requested for the
job</li>
<li>
<code>MaxRSS</code> = <code>AveRSS</code>: low fluctuation in
memory, data is held throughout the whole job</li>
<li>
<code>MaxPages</code> &amp; <code>AvePages</code>: number of pages
loaded into memory</li>
<li>
<code>MaxDiskRead</code>: Data read from disk by the application,
but also to start the application.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="shortcomings">Shortcomings<a class="anchor" aria-label="anchor" href="#shortcomings"></a>
</h2>
<hr class="half-width">
<p>While <code>seff</code> and <code>sacct</code> provide a lot of
information it is still incomplete. For example, the information is
accumulated for the entire calculation. Variations in the metrics as a
function of time throughout the job are not available. Communication
between different MPI processes is not recorded. The collection of the
energy consumption depends on the hardware and system configuration at
the HPC center and might not be available. We are also often missing
reliable measurements for I/O via the interconnect between nodes and the
parallel file system.</p>
<p>So while we might be able to glean some indications for different
types of performance problems, for a proper analysis more detailed
information is needed.</p>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>This episode introduced the SLURM tools <code>seff</code> and
<code>sacct</code> to get a high level perspective on a job’s
performance. As these tools just use the statistics that SLURM collected
on a job as it ran, they can always be used without any special
preparation.</p>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>So far we have considered our initial calculation using 4 cores. To
run the calculation faster we could consider using more cores. Run the
same calculation on 8, 16, and 32 cores as well. Collect and compare the
results from <code>sacct</code> and see how the job performance
changes.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>The machine these calculations have been run on has 112 core per
node. So we can double the number of cores from 4 until 64 and stay
within one node. If we go to two nodes then some of the communication
between tasks will have to go across the interconnect. At that point the
performance characteristics might change in a discontinuous manner.
Hence we try to avoid doing that.</p>
<p>Alternatively you might scale the calculation across multiple nodes,
for example 2, 4, 8, 16 nodes. With 112 cores per node you would have to
make sure that the calculation is large enough for such a large number
of cores to make sense.</p>
<p>Create <code>running_snowmen.sh</code> with</p>
<pre class="input"><code>#!/usr/bin/bash
for nn in 4 8 16 32; do
    id=`sbatch --parsable --time=00:12:00 --nodes=1 --tasks-per-node=$nn --ntasks-per-core=1 render_snowman.sh`
    echo "ntasks $nn jobid $id"
done</code></pre>
<p>Create <code>render_snowman.sh</code> with</p>
<pre class="input"><code>#!/usr/bin/bash

# Possibly a "module load ..." command to load required libraries
# Depends on your particular HPC system

export START=`pwd`
# Create a sub-directory for this job if it doesn't exist already
mkdir -p $START/test.$SLURM_NTASKS
cd $START/test.$SLURM_NTASKS
# The -spp flag ensures we have enough samples per ray such that the job
# on 32 cores takes longer than 30s. Slurm by default is configured such
# that job data is collected every 30s. If the job finishes in less than
# that Slurm might fail to collect some of the data about the job.
mpirun -np $SLURM_NTASKS raytracer -width=800 -height=800 -spp 1024 -threads=1 -alloc_mode=3 -png=rendered_snowman.png</code></pre>
<p>Next we submit this whole set of calculations</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">./running_snowmen.sh</span></span></code></pre>
</div>
<p>producing</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ntasks 4 jobid 349291
ntasks 8 jobid 349292
ntasks 16 jobid 349293
ntasks 32 jobid 349294</code></pre>
</div>
<p>After the jobs are completed we can run</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">sacct</span> <span class="at">--jobs</span><span class="op">=</span>349291,349292,349293,349294 <span class="dt">\</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>      <span class="at">--format</span><span class="op">=</span>MaxRSS,AveRSS,MaxPages,AvePages,AllocCPUS,Elapsed,MaxDiskRead,MaxDiskWrite,ConsumedEnergy,AveCPUFreq</span></code></pre>
</div>
<p>to produce</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    MaxRSS     AveRSS MaxPages   AvePages  AllocCPUS    Elapsed  MaxDiskRead MaxDiskWrite ConsumedEnergy AveCPUFreq
---------- ---------- -------- ---------- ---------- ---------- ------------ ------------ -------------- ----------
                                                   4   00:09:35                                        0
   142676K    142676K        1          1          4   00:09:35        7.75M        0.72M              0       743K
         0          0        0          0          4   00:09:35        0.01M        0.00M              0      2.61M
                                                   8   00:05:01                                        0
   289024K    289024K        0          0          8   00:05:01       10.15M        1.45M              0       960K
         0          0        0          0          8   00:05:02        0.01M        0.00M              0      2.42M
                                                  16   00:02:21                                        0
   563972K    563972K       93         93         16   00:02:21       15.00M        2.94M              0      1.03M
         0          0        0          0         16   00:02:21        0.01M        0.00M              0      2.99M
                                                  32   00:01:14                                        0
  1082540K   1082540K      260        260         32   00:01:14       24.83M        6.07M              0      1.08M
         0          0        0          0         32   00:01:14        0.01M        0.00M              0         3M</code></pre>
</div>
<p>Note that the elapse time goes down as the number of cores increases,
which is reasonable as more cores normally can get the job done quicker.
The amount of data read also increases as every MPI rank has to read the
executable and all associated shared libraries. The volume of data
written is harder to understand. Every run produces an image file
<code>rendered_snowman.png</code> that is about 100KB in size. This file
is written just by the root MPI rank. This cannot explain the increase
in data written with increasing numbers of cores. The increasing number
of page faults with increasing numbers of cores suggests that paging
memory to disk is responsible for the majority of data written.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Schedulers provide tools for a high level view on our jobs,
e.g. <code>sacct</code> and <code>seff</code>
</li>
<li>Important basic performance metrics we can gather this way are:
<ul>
<li>
<strong>CPU Utilization</strong>, often as fraction of
<code>time where CPU was active</code>/<code>elapsed time of the job</code>
</li>
<li>
<strong>Memory utilization</strong>, often measured as <em>Resident
Set Size</em> (RSS) and number of <em>Pages</em>
</li>
</ul>
</li>
<li>
<code>sacct</code> can also provide metrics about disk I/O and
energy consumption</li>
<li>Metrics through <code>sacct</code> are accumulated for the whole job
runtime and may be too broad for more specific insight</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-04_scalingstudy"><p>Content from <a href="04_scalingstudy.html">Scaling Study</a></p>
<hr>
<p>Last updated on 2025-10-29 |

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/episodes/04_scalingstudy.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 70 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How many resources should we request for a given job?</li>
<li>How does our application behave at different scales?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to …</p>
<ul>
<li>Perform a simple scaling study for a given application.</li>
<li>Identify good working points for the job configuration.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Intention: Introduce/Recollect concept of Speedup and do a simple scaling study </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Narrative:</p>
<ul>
<li>We panic, maybe we need more resources to meet the deadline with our
title picture!</li>
<li>Requesting resources with bigger systems requires a project proposal
with an estimate of the resource demand</li>
</ul>
<p>What we’re doing here:</p>
<ul>
<li>Vary number of cores</li>
<li>Which metrics are most useful?</li>
<li>Define speedup</li>
<li>Visualize results</li>
</ul>
<p>ToDo:</p>
<ul>
<li>Define example payload
<ul>
<li>Long enough to be significant</li>
<li>Short enough to be feasible for a quick study</li>
</ul>
</li>
<li>Identify dimension for scaling study, e.g.
<ul>
<li>number of processes (on a single node)</li>
<li>number of processes (across nodes)</li>
<li>number of nodes involved (network-communication boundary)</li>
<li>size of workload</li>
<li>Decide on number of processes across node, fixed workload size</li>
</ul>
</li>
<li>Choose limits (e.g. 1, 2, 4, … cores), within reasonable size for
given Cluster</li>
<li>Beyond nodes? Set to one node?</li>
</ul>
</div>
</div>
</div>
</div>
<p>Panic! The deadline is approaching way too fast and we may not finish
our project in time. Maybe requesting more resources from our clusters
scheduler does the trick? How could we know if it helps and by how
much?</p>
<section><h2 class="section-heading" id="what-is-scaling">What is Scaling?<a class="anchor" aria-label="anchor" href="#what-is-scaling"></a>
</h2>
<hr class="half-width">
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Todo: show, don’t tell </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" aria-labelledby="headingInstructor2" data-bs-parent="#accordionInstructor2">
<div class="accordion-body">

</div>
</div>
</div>
</div>
<p>Answer: how much does it help to add more CPU cores, if I keep the
problem sized fixed? (Translates to: samples per pixel, number of
pixels, same scene) Vary the number of CPU cores and look at behaviour
with <code>time</code>, <code>seff</code>, <code>sacct</code></p>
<ul>
<li>Prepare script to use <code>${SLURM_NTASKS}</code> in
<code>mpirun -n</code> and <code>time</code>.</li>
<li>Live coding, executing on single node (-N 1) and motivate <span class="math inline">\(2^N\)</span>:
<ul>
<li>Run with 1 core as baseline (can we reuse value from before?)</li>
<li>Run with 2 cores</li>
<li>Run with 4 cores</li>
<li>Run with 8 cores</li>
<li>Run with 16 cores</li>
</ul>
</li>
<li>Compare wall times, and some <code>seff</code>, <code>sacct</code>
metrics</li>
<li>Use grep to quickly compare executions qualitatively</li>
<li>See need to compare it in a clearer way</li>
<li>List times</li>
<li>Introduce “strong scaling”</li>
<li>Introduce Speedup</li>
<li>Calculate Speedup for examples above</li>
<li>Exercise to extend executions and gather all speedups</li>
<li>Draw speedup vs. <span class="math inline">\(N\)</span>
</li>
<li>Observe overhead &amp; compare to perfect scaling</li>
<li>Introduce Amdahls Law</li>
</ul>
<p>Answer: Why go in steps of <span class="math inline">\(2^n\)</span>?
Often aligns well to available resources (number of cores etc.), also a
bit of tradition</p>
<p>List times in csv file:</p>
<pre class="csv"><code>time,ntasks,size
909.241,2,1600
462.018,4,1600
245.603,8,1600
124.328,16,1600</code></pre>
<p><strong>Strong scaling</strong> is limited by parallelizable
fraction. At some point adding more cores does not help. =&gt; Amdahls
law. picture of serial and parallel fractions w.r.t Amdahls law.</p>
<p>The <em>Speedup</em> metric is often used to compare the execution
with different amounts of resources. Speedup answers the question</p>
<blockquote>
<p>How much faster is the application with <span class="math inline">\(N\)</span> parallel processes/threads, compared to
the serial execution with <span class="math inline">\(1\)</span>
process/threads?</p>
</blockquote>
<p>It’s defined through the comparison of wall times <span class="math inline">\(T(p)\)</span> of the application with <span class="math inline">\(p\)</span> parallel processes: <span class="math display">\[S = \frac{T(1)}{T(N)}\]</span> Here, <span class="math inline">\(T(1)\)</span> is the wall time for a sequential
execution, and <span class="math inline">\(T(N)\)</span> is the
execution with <span class="math inline">\(N\)</span> parallel
processes.</p>
<p>Plot results (Black board, prepared python script, piece of
paper?)</p>
<p>Additionally, adding more CPU cores can actively slow down the
process. Each process introduces some communication overhead. Between
processes, and if it is distributed among multiple servers/worker nodes,
also between processes through the network.</p>
<div id="exercise-continue-scaling-study" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="exercise-continue-scaling-study" class="callout-inner">
<h3 class="callout-title">Exercise: Continue scaling study</h3>
<div class="callout-content">
<ul>
<li>Continue with 32, 64, and 128 cores</li>
<li>Go beyond single node, use all cores of two nodes</li>
<li>Take <code>time</code> measurements (maybe: ideally multiple and
with <code>--exclusive</code>)</li>
<li>Prepare a list of results in a csv with the format (what’s ntasks,
what’s size?):</li>
</ul>
<p>Questions:</p>
<ul>
<li>Can we “see” the network between both nodes?</li>
<li>Is there a slow down already?</li>
<li>What does it tell about the parallelization of the application?</li>
</ul>
<p>Some points may be:</p>
<ul>
<li>How serial portion of the code effects the scaling?</li>
<li>If we have a infinite number of workers or processes doing a highly
parallel code which is 99% is parallelized but 1% is serial execution.
The speedup will be 100. What is the ideal limit to speedup?</li>
<li>How the communication affects the scaling?</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="speedup-and-efficiency">Speedup and Efficiency<a class="anchor" aria-label="anchor" href="#speedup-and-efficiency"></a>
</h2>
<hr class="half-width">
<p>Different representation of the info above. Answers: how much does it
help to add more cores?</p>
<p>Define efficiency w.r.t speedup.</p>
<div id="exercise-speedup-and-efficiency" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="exercise-speedup-and-efficiency" class="callout-inner">
<h3 class="callout-title">Exercise: Speedup and Efficiency</h3>
<div class="callout-content">
<p>Plot efficiency and make a guess when adding more cores is not worth
it.</p>
</div>
</div>
</div>
<div id="discussion-when-should-we-stop-adding-cpu-cores" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="discussion-when-should-we-stop-adding-cpu-cores" class="callout-inner">
<h3 class="callout-title">Discussion: When should we stop adding CPU
cores?</h3>
<div class="callout-content">
<p>Discuss the previous (potentially subjective) results and decide on a
good approach in the group.</p>
<p>Depends on X, Y, and Z. Could be around #N cores. It’s an
optimization problem!</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="if-scaling-is-limited-why-are-there-larger-hpc-systems">If scaling is limited, why are there larger HPC systems?<a class="anchor" aria-label="anchor" href="#if-scaling-is-limited-why-are-there-larger-hpc-systems"></a>
</h2>
<hr class="half-width">
<p>What if the project benefits from increasing the problem size:</p>
<ul>
<li>More detail/resolution may lead to more accurate result.</li>
<li>More repetitions may improve statistics</li>
</ul>
<p>Scaling up the problem size, while also scaling up the compute
resources (CPU cores) is called weak scaling.</p>
<p>=&gt; Gustafsons Law</p>
<div id="exercise-weak-scaling" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-weak-scaling" class="callout-inner">
<h3 class="callout-title">Exercise: Weak scaling</h3>
<div class="callout-content">
<ul>
<li>Run with 1, 2, 4, 8, 16, 32, 64 on single node</li>
<li>Increase problem size at the same time by same fraction
(e.g. 800x800 pixels on 1 core, 1131x1131 on 2 cores, 1600x1600 on 4,
<span class="math inline">\(\sqrt{640000 \times N}\)</span> on <span class="math inline">\(N\)</span> cores)</li>
<li>Take <code>time</code> measurements (maybe: ideally multiple and
with <code>--exclusive</code>)</li>
</ul>
<p>How does it scale now? Would we benefit from increasing the problem
size in this case?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Maybe not, if picture is good enough</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>What is scaling? What’s a good working point for our example (at a
given workload)?</p>
<p>What’s a good working point? When is a overhead setting in? Not the
same for all kinds of applications!</p>
<p>Requests for computational time (project proposals) may require
scaling study.</p>
<p>Recollect scaling study: compared change of wall time with number of
cores and computational workload. We can look at any parameter this way
and study the impact on walltime, CPU utilization, FLOPS, memory
utilization, communication, output size on disk with respect to any
parameter of our job or our application.</p>
<p><a href="https://carpentries-incubator.github.io/hpc-workflows-jube/" class="external-link">Reproducible
HPC workflows using JUBE</a></p>
<p>Leading question: <code>time</code> and scheduler tools still don’t
provide a complete picture, what other ways are there? -&gt; Introduce
third party tools to get a good performance overview</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Jobs behave differently with varying resources and workloads</li>
<li>Scaling study is necessary to check behavior of the application</li>
<li>Good working points defined by sections where more cores still
provide sufficient speedup, but no costs due to overhead etc.
occurs</li>
<li>Amdahl’s law: speedup is limited by serial fraction of the
program</li>
<li>Gustafson’s law: more resources still help, if larger workloads can
be used</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-05_performancereports"><p>Content from <a href="05_performancereports.html">Performance Overview</a></p>
<hr>
<p>Last updated on 2025-11-11 |

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/episodes/05_performancereports.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Is it enough to look at a jobs walltime?</li>
<li>What steps can I take to evaluate a jobs performance?</li>
<li>What popular types of reports exist?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to …</p>
<ul>
<li>Explain different approaches to performance measurements.</li>
<li>Understand common terms and concepts in performance analyses.</li>
<li>Create a performance report through a third-party tool.</li>
<li>Describe what a performance report is meant for (establish baseline,
documentation of issues and improvements through optimization,
publication of results, finding the next thread to pull in a quest for
optimization)</li>
<li>Measure the performance of central components of underlying hardware
(CPU, Memory, I/O, …) (split episode?)</li>
<li>Identify which general areas of computer hardware may affect
performance.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Intention: Introduce third party tools for performance reports </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Narrative:</p>
<ul>
<li>Scaling study, scheduler tools, project proposal is written and
handed in</li>
<li>Maybe I can squeeze out more from my current system by trying to
understand better how it behaves</li>
<li>Another colleague told us about performance measurement tools</li>
<li>We are learning more about our application</li>
<li>Aha, there IS room to optimize! Compile with vectorization</li>
</ul>
<p>What we’re doing here:</p>
<ul>
<li>Get a complete picture</li>
<li>Introduce missing metrics / definitions, and popular representations
of data, e.g. Roofline</li>
<li>Relate to hardware on the same level of detail</li>
</ul>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<hr class="half-width">
<ul>
<li>Previously checked scaling behavior by looking at walltime</li>
<li>what if we would count other things while our job is running? Could
be
<ul>
<li>CPU utilization</li>
<li>FLOPS</li>
<li>Memory uitilization</li>
<li>…</li>
</ul>
</li>
<li>Two possible ways to look at this data with respect to time:
<ol style="list-style-type: decimal">
<li>
<em>tracing</em>: over time</li>
<li>
<em>sampling</em>: accumulated results at the end</li>
</ol>
</li>
<li>Third-party tools to measure these things - you can use them with
your jobs</li>
</ul>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Pick a main tool </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>We go with three alternatives here, pick one an stick to it
throughout your course, but highlight that there are alternatives and
learners may not have access to certain tools on any cluster.</p>
</div>
</div>
</div>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Here you can choose between three alternative perspectives on our
job:</p>
<ol style="list-style-type: decimal">
<li>
<a href="https://clustercockpit.org/" class="external-link"><em>ClusterCockpit</em></a>: A
job monitoring service available on many of our clusters. Needs to be
centrally maintained by your HPC administration team.</li>
<li>
<a href="https://docs.linaroforge.com/25.0.4/html/forge/performance_reports/index.html" class="external-link"><em>Linaro
Forge Performance Reports</em></a>: A commercial application providing a
single page performance overview of your job. Your cluster may have
licenses available.</li>
<li>
<em>TBD</em>: A free, open source tool/set of tools, to get a
general performance overview of your job.</li>
</ol>
<p>Performance counters and permissions, may require
<code>--exclusive</code>, depends on system! Look at documentation /
talk to your administrators / support.</p>
<pre><code>cap_perfmon,cap_sys_ptrace,cap_syslog=ep
kernel.perf_event_paranoid</code></pre>
</div>
</div>
</div>
<p>Live coding:</p>
<ul>
<li>Set up the main tool. How do I access it? How can I use it with my
job?</li>
<li>Run snowman with 8 cores</li>
</ul>
<div class="tabs">
<nav><div id="nav-tab-1" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-1-ClusterCockpit" name="ClusterCockpit" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-ClusterCockpit" type="button" role="tab" aria-controls="nav-tabpanel-1-ClusterCockpit" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-1-ClusterCockpit">
  ClusterCockpit
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-PerformanceReports" name="PerformanceReports" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-PerformanceReports" type="button" role="tab" aria-controls="nav-tabpanel-1-PerformanceReports" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-PerformanceReports">
  Performance Reports
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-TBD" name="TBD" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-TBD" type="button" role="tab" aria-controls="nav-tabpanel-1-TBD" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-TBD">
  TBD
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-1" class="tab-content">
<div id="nav-tabpanel-1-ClusterCockpit" class="tab-pane show active" role="tabpanel" aria-labelledby="nav-tab-1-ClusterCockpit">
<ol style="list-style-type: decimal">
<li>Setup: webpage &amp; login. An conditions on when it is enabled in
your particular cluster?</li>
<li>If always enabled: figure out jobid of previous 8-core job from
Episode 4</li>
</ol>
</div>
<div id="nav-tabpanel-1-PerformanceReports" class="tab-pane" role="tabpanel" aria-labelledby="nav-tab-1-PerformanceReports">
<ol style="list-style-type: decimal">
<li>(Check for licenses?)</li>
<li>Setup: load software modules</li>
<li>Submit job with <code>perf-report</code>
</li>
</ol>
</div>
<div id="nav-tabpanel-1-TBD" class="tab-pane" role="tabpanel" aria-labelledby="nav-tab-1-TBD">
<p>N/A</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="general-report">General report<a class="anchor" aria-label="anchor" href="#general-report"></a>
</h2>
<hr class="half-width">
<div class="tabs">
<nav><div id="nav-tab-2" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-2-ClusterCockpit" name="ClusterCockpit" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-ClusterCockpit" type="button" role="tab" aria-controls="nav-tabpanel-2-ClusterCockpit" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-2-ClusterCockpit">
  ClusterCockpit
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-PerformanceReports" name="PerformanceReports" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-PerformanceReports" type="button" role="tab" aria-controls="nav-tabpanel-2-PerformanceReports" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-PerformanceReports">
  Performance Reports
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-TBD" name="TBD" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-TBD" type="button" role="tab" aria-controls="nav-tabpanel-2-TBD" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-TBD">
  TBD
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-2" class="tab-content">
<div id="nav-tabpanel-2-ClusterCockpit" class="tab-pane show active" role="tabpanel" aria-labelledby="nav-tab-2-ClusterCockpit">
<ul>
<li>Job meta data</li>
<li>Footprint</li>
<li>Roofline plot</li>
<li>Detailed plots</li>
<li>Tabled statistics</li>
</ul>
<ol style="list-style-type: decimal">
<li>Go to webpage</li>
<li>Navigate to the job</li>
<li>Discuss overall info on a broad level
<ul>
<li>Job meta data</li>
<li>Footprint</li>
<li>Roofline plot</li>
<li>Detailed plots</li>
<li>Tabled statistics</li>
</ul>
</li>
</ol>
</div>
<div id="nav-tabpanel-2-PerformanceReports" class="tab-pane" role="tabpanel" aria-labelledby="nav-tab-2-PerformanceReports">
<ul>
<li>Computing</li>
<li>Memory</li>
<li>Communication</li>
<li>…</li>
</ul>
<ol style="list-style-type: decimal">
<li>Identify result files (txt, html)</li>
<li>Look at txt with editor</li>
<li>Copy html to local computer &amp; open it with browser</li>
<li>Discuss report on a broad level
<ul>
<li>Computing</li>
<li>Memory</li>
<li>Communication</li>
<li>…</li>
</ul>
</li>
</ol>
</div>
<div id="nav-tabpanel-2-TBD" class="tab-pane" role="tabpanel" aria-labelledby="nav-tab-2-TBD">
<p>N/A</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="how-does-performance-relate-to-hardware">How Does Performance Relate to Hardware?<a class="anchor" aria-label="anchor" href="#how-does-performance-relate-to-hardware"></a>
</h2>
<hr class="half-width">
<div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> ToDo: Connect Hardware to Performance Measurements </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor3" aria-labelledby="headingInstructor3">
<div class="accordion-body">
<p>Introduce hardware on the same level of detail and with the same
terms as the performance reports by ClusterCockpit, LinaroForge, etc.,
as soon as they appear. Only introduce what we need, to avoid info dump.
But point to additional information that gives a complete overview -&gt;
hpc-wiki!</p>
</div>
</div>
</div>
</div>
<p>(Following this structure throughout the course, trying to understand
the performance in these terms)</p>
<p>Broad dimensions of performance:</p>
<ul>
<li>CPU (Front- and Backend, FLOPS)
<ul>
<li>Frontend: decoding instructions, branch prediction, pipeline</li>
<li>Backend: getting data from memory, cache hierarchy &amp;
alignment</li>
<li>Raw calculations</li>
<li>Vectorization</li>
<li>Out-of-order execution</li>
</ul>
</li>
<li>Accelerators (e.g. GPUs)
<ul>
<li>More calculations</li>
<li>Offloading</li>
<li>Memory &amp; communication models</li>
</ul>
</li>
<li>Memory (data hierarchy)
<ul>
<li>Working memory, reading data from/to disk</li>
<li>Bandwidth of data</li>
</ul>
</li>
<li>I/O (broader data hierarchy: disk, network)
<ul>
<li>Stored data</li>
<li>Local disk (caching)</li>
<li>Parallel fs (cluster-wide)</li>
<li>MPI-Communiction</li>
</ul>
</li>
<li>Parallel timeline (synchronization, etc.)
<ul>
<li>Application logic</li>
</ul>
</li>
</ul>
<div id="accordionInstructor4" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor4" aria-expanded="false" aria-controls="collapseInstructor4">
  <h3 class="accordion-header" id="headingInstructor4">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> ToDo: Clarify relation to hardware in this course </h3>
</button>
<div id="collapseInstructor4" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor4" aria-labelledby="headingInstructor4">
<div class="accordion-body">
<p>Maybe we should either focus on components (CPUs, memory, disk,
accelerators, network cards) or functional entities (compute, data
hierarchy, bandwidth, latency, parallel timelines)</p>
<p>We shouldn’t go into too much detail here. Define broad categories
where performance can be good or bad. (calculations, data transfers,
application logic, research objective (is the calculation
meaningful?))</p>
<p>Reuse categories in the same order and fashion throughout the course,
i.e. point out in what area a discovered inefficiency occurs.</p>
<p>Introduce detail about hardware later where it is needed, e.g. NUMA
for pinning and hints.</p>
</div>
</div>
</div>
</div>
<figure><img src="../fig/JobEfficiency.drawio.png" alt="Hardware" class="figure mx-auto d-block"><div class="figcaption">Hardware</div>
</figure><div id="exercise-match-application-behavior-to-hardware" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-match-application-behavior-to-hardware" class="callout-inner">
<h3 class="callout-title">Exercise: Match application behavior to
hardware</h3>
<div class="callout-content">
<p>Which part of the computer hardware may become an issue for the
following application patterns:</p>
<ol style="list-style-type: decimal">
<li>Calculating matrix multiplications</li>
<li>Reading data from processes on other computers</li>
<li>Calling many different functions from many equally likely if/else
branches</li>
<li>Writing very large files (TB)</li>
<li>Comparing many different strings if they match</li>
<li>Constructing a large simulation model</li>
<li>Reading thousands of small files for each iteration</li>
</ol>
<p>Maybe not the best questions, also missing something for
accelerators.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>CPU (FLOPS) and/or Parallel timeline</li>
<li>I/O (network)</li>
<li>CPU (Front-End)</li>
<li>I/O (disk)</li>
<li>(?) CPU-Backend, getting strings through the cache?</li>
<li>Memory (size)</li>
<li>I/O (disk)</li>
</ol>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<ul>
<li>General reports show direction in which to continue
<ul>
<li>Specialized tools may be necessary to move on</li>
</ul>
</li>
</ul>
<p>Leading question: Connection to hardware is quite deep, why does it
matter? -&gt; Drill deeper, e.g. on NUMA &amp; pinning</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>First things first, second things second, …</li>
<li>Profiling, tracing</li>
<li>Sampling, summation</li>
<li>Different HPC centers may provide different approaches to this
workflow</li>
<li>Performance reports offer more insight into the job and application
behavior</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-06_pinning"><p>Content from <a href="06_pinning.html">Pinning</a></p>
<hr>
<p>Last updated on 2025-10-31 |

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/episodes/06_pinning.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is “pinning” of job resources?</li>
<li>How can pinning improve the performance?</li>
<li>How can I see, if pinning resources would help?</li>
<li>What requirement hints can I give to the scheduler?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to …</p>
<ul>
<li>Define the concept of “pinning” and how it can affect job
performance.</li>
<li>Name Slurms options for memory- and cpu- binding.</li>
<li>Use hints to tell Slurm how to optimize their job allocation.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Intention: Go deeper in performance and hardware relationship </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Narrative:</p>
<ul>
<li>We get the feeling, that hardware has a lot to offer, but the rabbit
hole is deep!</li>
<li>What are the “dimensions” in which we can optimize the throughput of
snowman pictures per hour?</li>
<li>Can we improve how the work maps to certain CPUs / Memory
regions?</li>
</ul>
<p>What we’re doing here:</p>
<ul>
<li>Introduce pinning and slurm hint options</li>
<li>Relate to hardware effects</li>
<li>Use third party performance tools to observe effects!</li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> ToDo: Extract episode about pinning </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" aria-labelledby="headingInstructor2" data-bs-parent="#accordionInstructor2">
<div class="accordion-body">
<p>Stick to simple options here. Put more complex options for pinning /
hints, etc. into its own episode somewhere later in the course</p>
<p>Pinning is an important part of job optimization, but requires some
knowledge, e.g. about the hardware hierarchies in a cluster, NUMA, etc.
So it should be done after we’ve introduced different performance
reports and their perspective on hardware</p>
<p>Maybe point to <a href="https://apps.fz-juelich.de/jsc/llview/pinning" class="external-link">JSC pinning
simulator</a> and have similar diagrams as an independent “offline”
version in this course</p>
</div>
</div>
</div>
</div>
<p>Binding / pinning:</p>
<ul>
<li><code>--mem-bind=[{quiet|verbose},]&lt;type&gt;</code></li>
<li><code>-m, --distribution={*|block|cyclic|arbitrary|plane=&lt;size&gt;}[:{*|block|cyclic|fcyclic}[:{*|block|cyclic|fcyclic}]][,{Pack|NoPack}]</code></li>
<li>
<code>--hint=</code>: Hints for CPU- (<code>compute_bound</code>)
and memory-bound (<code>memory_bound</code>), but also
<code>multithread</code>, <code>nomultithread</code>
</li>
<li>
<code>--cpu-bind=[{quiet|verbose},]&lt;type&gt;</code>
(<code>srun</code>)</li>
<li>Mapping of application &lt;-&gt; job resources</li>
</ul>
<section><h2 class="section-heading" id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<hr class="half-width">
<div id="exercise" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Case 1: 1 thread per rank
<code>mpirun -n 8 ./raytracer -width=512 -height=512 -spp=128 -threads=1 -alloc_mode=3 -png=snowman.png</code></p>
<p>Case 2: 2 thread per rank
<code>mpirun -n 8 ./raytracer -width=512 -height=512 -spp=128 -threads=2 -alloc_mode=3 -png=snowman.png</code></p>
<p>Questions: - Do you notice any difference in runtime between the two
cases? - Is the increase in threads providing a speedup as expected?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ul>
<li>Observation: The computation times are almost the same.</li>
<li>Expected behavior: Increasing threads should ideally reduce
runtime.</li>
<li>Hypothesis: Additional threads do not contribute.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="how-to-investigate">How to investigate?<a class="anchor" aria-label="anchor" href="#how-to-investigate"></a>
</h2>
<hr class="half-width">
<p>You can verify the actual core usage in two ways: 1. Use
<code>--report-bindings</code> with <code>mpirun</code> 2. Use
<code>htop</code>command on the compute node</p>
<div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Note: Login to the compute job </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" aria-labelledby="headingInstructor3" data-bs-parent="#accordionInstructor3">
<div class="accordion-body">
<p>This is cluster specific. It can possibly be done in two ways: 1.
<code>srun --pty --overlap --jobid=&lt;jobid&gt; /bin/bash</code> 2.
Check on which node job runs and login to the node via SSH</p>
</div>
</div>
</div>
</div>
<div id="exercise-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Follow any one of the option above and run for 2 threads per rank
<code>mpirun -n 8 ./raytracer -width=512 -height=512 -spp=128 -threads=2 -alloc_mode=3 -png=snowman.png</code></p>
<p>Questions: - Did you find any justification for the hypothesis we
made?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Only 8 cores are active instead of 16</p>
</div>
</div>
</div>
</div>
<p>Explanation:</p>
<ul>
<li>Eventhough we requested 2 threads per MPI rank, both threads are
pinned to the same core.</li>
<li>The second thread waits for the first thread to finish, so no actual
thread-level parallelization is achieved.</li>
</ul>
<div id="accordionInstructor4" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor4" aria-expanded="false" aria-controls="collapseInstructor4">
  <h3 class="accordion-header" id="headingInstructor4">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> TODO: Show an animation </h3>
</button>
<div id="collapseInstructor4" class="accordion-collapse collapse" aria-labelledby="headingInstructor4" data-bs-parent="#accordionInstructor4">
<div class="accordion-body">
<ul>
<li>current behavior with overlapping threads on the same core.</li>
<li>Expected behavior when threads are pinned to separate cores.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="how-to-achieve">How to achieve?<a class="anchor" aria-label="anchor" href="#how-to-achieve"></a>
</h2>
<hr class="half-width"></section><section><h2 class="section-heading" id="exercise-understanding-process-and-thread-binding">Exercise: Understanding Process and Thread Binding<a class="anchor" aria-label="anchor" href="#exercise-understanding-process-and-thread-binding"></a>
</h2>
<hr class="half-width">
<p>Pinning (or binding) means locking a process or thread to a specific
hardware resource such as a CPU core, socket, or NUMA region. Without
pinning, the operating system may move tasks between cores, which can
reduce cache reuse and increase memory latency, directly diminishes
performance.</p>
<p>In this exercise we will explore how MPI process and thread binding
works. We will try binding to <strong>core</strong>,
<strong>socket</strong>, and <strong>numa</strong>, and observe timings
and bindings.</p>
<div id="accordionInstructor5" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor5" aria-expanded="false" aria-controls="collapseInstructor5">
  <h3 class="accordion-header" id="headingInstructor5">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Note </h3>
</button>
<div id="collapseInstructor5" class="accordion-collapse collapse" aria-labelledby="headingInstructor5" data-bs-parent="#accordionInstructor5">
<div class="accordion-body">
<ul>
<li>This exercise assumes the following hardware setup:
<ul>
<li>Dual-socket system (2 sockets, 48 cores per socket, 8 NUMA regions,
96 cores total).<br>
</li>
<li>Each MPI process can use multiple threads (<code>-threads</code>)
for parallel execution.</li>
</ul>
</li>
<li>The idea is to <strong>demonstrate oversubscription</strong> by
giving more MPI processes than available sockets or NUMA regions, or by
over-allocating threads per domain.<br>
</li>
<li>You are free to adjust <code>-n</code> and <code>-threads</code>
based on your cluster.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="exercise-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-2" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Case 1: <code>--bind-to numa</code>
<code>mpirun -n 8 --bind-to numa ./raytracer -width=512 -height=512 -spp=128 -threads=12 -alloc_mode=3 -png=snowman.png</code></p>
<p>Case 2: <code>--bind-to socket</code>
<code>mpirun -n 4 --bind-to socket /raytracer -width=512 -height=512 -spp=128 -threads=48 -alloc_mode=3 -png=snowman.png</code></p>
<p>Questions: - What is difference between Case 1 and Case 2. Any
difference in performance? How many workers? - How could you adjust
process/thread counts to better utilize the hardware in Case 2?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<ul>
<li>MPI and thread pinning is hardware-aware.</li>
<li>If the number of processes matches the number of domains (socket or
NUMA), then the number of threads should equal the cores per domain to
fully utilize the node.</li>
<li>No speedup in Case 2: Oversubscription occurs because we requested 4
processes on a system with only 2 sockets.</li>
<li>Threads compete for the same cores → OpenMPI queues threads and
waits until other processes finish.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="best-practices-for-mpi-process-and-thread-pinning">Best Practices for MPI Process and Thread Pinning<a class="anchor" aria-label="anchor" href="#best-practices-for-mpi-process-and-thread-pinning"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="difference-between-binding-and-mapping">Difference between Binding and Mapping<a class="anchor" aria-label="anchor" href="#difference-between-binding-and-mapping"></a>
</h3>
<p><strong>Mapping</strong> is about distributing MPI ranks across
hardware hierarchy which tells where your processes will be placed.</p>
<p>**Binding* is locking your MPI processes/threads to a specific
resource which prevents from moving it around from one to another.</p>
</div>
</section><section><h2 class="section-heading" id="mapping-vs--binding-analogy">Mapping vs. Binding Analogy<a class="anchor" aria-label="anchor" href="#mapping-vs--binding-analogy"></a>
</h2>
<hr class="half-width">
<p>Think of running MPI processes and threads like booking seats for a
group of friends:</p>
<ul>
<li>
<strong>Mapping</strong> is like planning where your group will sit
in the theatre or on a flight.
<ul>
<li>Example: You decide some friends sit in Economy, some in Premium
Economy, and some in Business.<br>
</li>
<li>Similarly, <code>--map-by</code> distributes MPI ranks across nodes,
sockets, or NUMA regions.</li>
</ul>
</li>
<li>
<strong>Binding</strong> is like reserving the exact seats for each
friend in the planned area.
<ul>
<li>Example: Once the seating area is chosen, you assign specific seat
numbers to each friend.<br>
</li>
<li>Similarly, <code>--bind-to</code> pins each MPI process or thread to
a specific core or hardware unit to avoid movement.</li>
</ul>
</li>
</ul>
<p>This analogy helps illustrate why <strong>mapping defines
placement</strong> and <strong>binding enforces it</strong>.</p>
<p>We will use <code>--bind-to core</code> (the smallest hardware unit)
and <code>--map-by</code> to distribute MPI processes across sockets or
NUMA or node regions efficiently.</p>
<div class="section level3">
<h3 id="choosing-the-smallest-hardware-unit">Choosing the Smallest Hardware Unit<a class="anchor" aria-label="anchor" href="#choosing-the-smallest-hardware-unit"></a>
</h3>
<p>Binding processes to the smallest unit (core) is recommended
because:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Exclusive use of resources</strong><br>
Each process or thread is pinned to its own core, preventing multiple
threads or processes from competing for the same CPU.</p></li>
<li><p><strong>Predictable performance</strong><br>
When processes share cores, execution times can fluctuate due to
scheduling conflicts. Binding to cores ensures consistent timing across
runs.</p></li>
</ol>
<ul>
<li>Best practice: Always bind processes to the smallest unit (core) and
spread processes evenly across the available hardware using
<code>--map-by</code>.</li>
<li>Example options:
<ul>
<li>
<code>--bind-to core</code> → binds each process to a dedicated core
(avoids oversubscription).<br>
</li>
<li>
<code>--map-by socket:PE=&lt;threads&gt;</code> → spreads given
number of threads as a processing element across the socket</li>
<li>
<code>--map-by numa:PE=&lt;threads&gt;</code> → spreads processes
across NUMA domains, assigning <code>&lt;threads&gt;</code> cores per
process.</li>
<li>similarly <code>--map-by numa:PE=&lt;threads&gt;</code>
</li>
<li>
<code>--cpus-per-rank &lt;n&gt;</code>→ Assigns
<code>&lt;n&gt;</code> cores (hardware threads) to each MPI rank -
ensuring that all threads within a rank occupy separate cores.</li>
</ul>
</li>
</ul>
<div id="exercise-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="exercise-3" class="callout-inner">
<h3 class="callout-title">Exercise</h3>
<div class="callout-content">
<p>Use the given best practices above for case 1: <code>-n 8</code>,
<code>-threads=1</code> and case 2: <code>-n 8</code>,
<code>-threads=4</code> and answer following questions</p>
<p>Questions: - How many cores does the both jobs use? - Did you get
more workers than you requested? - Did you see the scaling when running
with 4 threads?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<ul>
<li>8 and 32</li>
<li>No.</li>
<li>Yes</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li><p><strong>Always check how pinning works</strong><br>
Use verbose reporting (e.g., <code>--report-bindings</code>) to see how
MPI processes and threads are mapped to cores and sockets.</p></li>
<li><p><strong>Documentation is your friend</strong><br>
For OpenMPI with <code>mpirun</code>, consult the manual: <a href="https://www.open-mpi.org/doc/v4.1/man1/mpirun.1.php" class="external-link">https://www.open-mpi.org/doc/v4.1/man1/mpirun.1.php</a></p></li>
<li><p><strong>Know your hardware</strong><br>
Understanding the number of sockets, cores per socket, and NUMA regions
on your cluster helps you make effective binding decisions.</p></li>
<li><p><strong>Avoid oversubscription</strong><br>
Assigning more threads or processes than available cores hurts
performance — it causes contention and idle waits.</p></li>
<li><p><strong>Recommended practice for OpenMPI</strong><br>
Use <code>--bind-to core</code> along with <code>--map-by</code> to
control placement and threads per process to maximize
throughput.</p></li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-07_bottlenecks"><p>Content from <a href="07_bottlenecks.html">How to identify a bottleneck?</a></p>
<hr>
<p>Last updated on 2025-09-24 |

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/episodes/07_bottlenecks.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I find the bottlenecks in a given job?</li>
<li>What are common workflows to evaluate performance?</li>
<li>What are some common types of bottlenecks?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to …</p>
<ul>
<li>Choose between multiple workflows to evaluate job performance.</li>
<li>Name typical performance issues.</li>
<li>Determine if their job is affected by one of these issues.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Intention: Uncover one or two issues in the application
  </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Narrative:</p>
<ul>
<li>Okay, what’s slowest with creating snowman pictures?</li>
<li>Where does our system choke?</li>
</ul>
<p>What we’re doing here:</p>
<ul>
<li>What’s a bottleneck?</li>
<li>How can we identify a bottleneck?</li>
<li>“Online” and “after the fact” workflows of performance measurements
(trace, accumulated results, attached to the process (live), or after it
ran)</li>
<li>Point to additional resources of common performance/bottleneck
issues, e.g. on hpc-wiki</li>
</ul>
<p>Maybe something like this already occurred before in 4. Scaling
Study, or 5. Performance Overview</p>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="how-to-identify-a-bottleneck">How to identify a bottleneck?<a class="anchor" aria-label="anchor" href="#how-to-identify-a-bottleneck"></a>
</h2>
<hr class="half-width">
<!-- EPISODE CONTENT HERE --></section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>Leading question: We were looking at a standard configuration with
CPU, Memory, Disks, Network, so far. What about GPU applications, which
are very common these days?</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>General advice on the workflow</li>
<li>Performance reports may provide an automated summary with
recommendations</li>
<li>Performance metrics can be categorized by the underlying hardware,
e.g. CPU, memory, I/O, accelerators.</li>
<li>Bottlenecks can appear by metrics being saturated at the physical
limits of the hardware or indirectly by other metrics being far from
what the physical limits are.</li>
<li>Interpreting bottlenecks is closely related to what the application
is supposed to do.</li>
<li>Relative measurements (baseline vs. change)
<ul>
<li>system is quiescent, fixed CPU freq + affinity, warmups, …</li>
<li>Reproducibility -&gt; link to git course?</li>
</ul>
</li>
<li>Scanning results for smoking guns</li>
<li>Any best practices etc.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-08_accelerators"><p>Content from <a href="08_accelerators.html">Performance of Accelerators</a></p>
<hr>
<p>Last updated on 2025-09-24 |

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/episodes/08_accelerators.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are accelerators?</li>
<li>How do they affect my jobs performance?</li>
<li>How can I measure accelerator utilization?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to …</p>
<ul>
<li>Understand difference of performance measurements on accelerators
(GPUs, FPGAs) to CPUs.</li>
<li>Understand how batch systems and performance measurements tools
treat accelerators.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Intention: Jump onto accelerator with the example application
  </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Narrative:</p>
<ul>
<li>The deadline is creeping up, only few ways to go!</li>
<li>Hey, we have a GPU partition! Maybe this will help us speed up the
process!</li>
</ul>
<p>What we’re doing here:</p>
<ul>
<li>What changes?</li>
<li>New metrics</li>
<li>Transfer to/from accelerator</li>
<li>Different options/requirements to scheduler &amp; performance
measurement tools</li>
</ul>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Run the same example workload on GPU and compare.</p>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  ToDo
  </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>Don’t mention FPGAs too much, maybe just a node what accelerators
could be, besides GPU. Goal is to keep it simple and accessible, focus
on what’s common in most HPC systems these days</p>
</div>
</div>
</div>
</div>
<div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  ToDo
  </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor3" aria-labelledby="headingInstructor3">
<div class="accordion-body">
<p>Explain how to decide where to run something. CPU vs. small GPU
vs. high-end GPUs. Touches on transfer overhead etc.</p>
</div>
</div>
</div>
</div>
<!-- EPISODE CONTENT HERE -->
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>Leading question: Performance optimization is a deep topic and we are
not done learning. How could I continue exploring the topic?</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Tools to measure GPU/FPGA performance of a job</li>
<li>Common symptoms of GPU/FPGA problems</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-09_nextsteps"><p>Content from <a href="09_nextsteps.html">Next Steps</a></p>
<hr>
<p>Last updated on 2025-10-29 |

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/episodes/09_nextsteps.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 10 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are other patterns of performance bottlenecks?</li>
<li>How to evaluate an application in more detail?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to …</p>
<ul>
<li>Find collection of performance patterns on hpc-wiki.info</li>
<li>Identify next steps to take with regard to performance
optimization.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Intention: Provide a roadmap learners could follow
  </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p><strong>Most important:</strong> enable users to translate from
example workload to their own code! Guide on how to translate learning
goals and key points to their situation. Additionally, provide some info
on where and how to dig deeper, if there is interest (application
profiling, etc.)</p>
<p>All ideas in this episode may need to be reworked, since they were
made with the outlook in mind, not so much to help learners transfer
insight</p>
<p>Narrative:</p>
<ul>
<li>Start with picture of beautiful title slide of the talk with the
snowman picture</li>
<li>Next time we want to tackle the issue way in advance</li>
<li>Approach our raytracing application more systematically, such that
we can get the title slide done much quicker</li>
<li>What could we do to dive deeper in optimizing the raytracer?</li>
<li>Where can we go from here?</li>
</ul>
<p>What we’re doing here:</p>
<ul>
<li>Learning important programming concepts (parallel programming on
many levels)</li>
<li>Deeper application profiling &amp; tools to use</li>
</ul>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<hr class="half-width">
<p>hpc-wiki.info - I/O - CPU Front End - CPU Back End - Memory leak -
Oversubscription - Underutilization</p>
<!-- EPISODE CONTENT HERE -->
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>There are many profilers, some are language-specific, others are
vendor-related, …</li>
<li>Simple profile with exclusive resources</li>
<li>Repeated measurements for reliability</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/stderr-enst/jobefficiency/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/stderr-enst/jobefficiency/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/stderr-enst/jobefficiency/" class="external-link">Source</a></p>
				<p><a href="https://github.com/stderr-enst/jobefficiency/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:helpdesk@hpc.nrw">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://stderr-enst.github.io/jobefficiency/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "hpc, software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://stderr-enst.github.io/jobefficiency/instructor/aio.html",
  "identifier": "https://stderr-enst.github.io/jobefficiency/instructor/aio.html",
  "dateCreated": "2025-03-28",
  "dateModified": "2025-11-18",
  "datePublished": "2025-11-18"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

